<layout>
  <div class="right_col" role="main">
    <div class="container">
      <div class="page-title">
        <div class="title_left">
          <h3 style="padding:15px 0 5px 0">Offer Request</h3>
        </div>
      </div>
      <div class="clearfix"></div>
      <hr />
      <div class="col-md-12 col-sm-12 ">

        <form [formGroup]="form" (ngSubmit)="onSubmit()">
          <div class="row">
            <div class="col-md-4 col-sm-4" [style.display]="(hasId)?'block':'none'">
              <label for="offReqNo">Offer Request No.</label>
              <input id="offReqNo" readonly type="text" formControlName="offReqNo" class="form-control">
            </div>
            <div class="col-md-4 col-sm-4">
              <label for="distributor">Distributor</label>
              <select id="distributor" type="text" formControlName="distributorid" class="form-control"
                [ngClass]="{ ' is -invalid': submitted && f.distributorid.errors}">
                <option *ngFor="let i of distributorList" value="{{i.id}}">{{i.distname}}
                </option>
              </select>
              <div Style="display: block" *ngIf="submitted && f.distributorid.errors" class="invalid-feedback">
                <div *ngIf="f.distributorid.errors.required">
                  distributor is required
                </div>
              </div>
            </div>
            <div class="col-md-4 col-sm-4" hidden>
              <label for="totalamount">Total Amount</label>
              <br>
              <select id="currency" style="display:inline-block; width:100px;" formControlName="currencyId"
                class="form-control" [ngClass]="{ ' is -invalid': submitted && f.currencyId.errors}">
                <option *ngFor="let i of currencyList" value="{{i.id}}">{{i.code}}
                </option>
              </select>

              <input id="totalamount" type="number" formControlName="totalamount" class="form-control"
                style="display:inline-block; width:270px; margin-left: 5px;"
                [ngClass]="{ ' is -invalid': submitted && f.totalamount.errors}" />
              <div Style="display: block" *ngIf="submitted && f.totalamount.errors" class="invalid-feedback">
                <div *ngIf="f.totalamount.errors.required">
                  totalamount is required
                </div>
              </div>
            </div>
            <div class="col-md-4 col-sm-4" hidden>
              <label for="status">Status</label>
              <input id="status" type="text" formControlName="status" class="form-control"
                [ngClass]="{ ' is -invalid': submitted && f.status.errors}" />
              <div Style="display: block" *ngIf="submitted && f.status.errors" class="invalid-feedback">
                <div *ngIf="f.status.errors.required">
                  status is required
                </div>
              </div>
            </div>
            <div class="col-md-4 col-sm-4">
              <label for="podate">RFQ Date</label>
              <input id="podate" type="text" disabled bsDatepicker formControlName="podate" class="form-control"
                [ngClass]="{ ' is -invalid': submitted && f.podate.errors}" />
              <div Style="display: block" *ngIf="submitted && f.podate.errors" class="invalid-feedback">
                <div *ngIf="f.podate.errors.required">
                  RFQ Date is required
                </div>
              </div>
            </div>
          </div>

          <div class="page-title">
            <div class="title_left">
              <h3 style="padding:15px 0 5px 0">Add Spare Parts</h3>
            </div>
          </div>
          <div class="clearfix"></div>
          <hr />

          <div class="row" style="margin-top:50px">
            <div class="col-md-9">
              <label for="browser">Search SpareParts By Part No. </label>
              <input (input)="SparePartsSearch($event.target.value?.split('==>')[0]?.trim())" #sparePartsSearch list="browsers"
                name="browser" id="browser" class="form-control">
              <datalist id="browsers">
                <option *ngFor="let i of sparePartsAutoComplete" value="{{i.partno}} ==> {{i.itemDescription}}">
              </datalist>
              <p style="color: red;">
                *If you dont find spare part above please add Description below
              </p>
            </div>

            <div class="col-md-3" style="margin-top:30px">
              <button class="btn btn-primary" (click)="AddSpareParts(sparePartsSearch.value?.split('==>')[0]?.trim())"
                type="button" class="btn btn-primary">Add SpareParts
              </button>
            </div>
          </div>

          <div class="row">
            <ag-grid-angular style="width: 100%; margin-top: 2.5%; height: 250px;" class="ag-theme-alpine"
              (cellValueChanged)="onCellValueChanged($event)" (cellClicked)="RemoveSpareParts($event)"
              (gridReady)="onGridReady($event)" [columnDefs]="columnDefs" [rowData]="sparePartsList"
              rowSelection="single" pagination="true" paginationPageSize=10>
            </ag-grid-angular>
          </div>

          <div class="row">
            <div class="col-md-6">
              <label for="otherSpareDesc">Description</label>
              <textarea id="otherSpareDesc" type="text" formControlName="otherSpareDesc"
                class="form-control"></textarea>
            </div>
          </div>
          <br />

          <div class="attachment my-4">

            <div class="page-title">
              <div class="title_left">
                <h3 style="padding:15px 0 5px 0">Attachments</h3>
              </div>
            </div>
            <div class="clearfix"></div>
            <hr />

            <div class="row" *ngIf="hasUpdateAccess || hasAddAccess" style="margin:15px;">
              <div class="col-md-3">
                <input type="file" id="myFile" #file placeholder="Choose file"
                  (change)="getfil(file.files); listfile(file.files) ;" multiple
                  accept="text/plain, application/pdf, image/*">
              </div>
              <div id="selectedfiles" class="hidden col-md-4" style="max-height:200px; overflow-y:auto;display: none;">
                <section style="margin:30px 0 0 50px; max-width:600px; min-width: 300px;">
                  <h5>Selected Files:</h5>
                  <hr />
                </section>

              </div>
            </div>

            <ag-grid-angular *ngIf="hasId" style="width: 100%; height: 250px;" class="my-4 ag-theme-alpine"
              (gridReady)="onGridReadyAttachments($event)" [columnDefs]="columnDefsAttachments" [rowData]="attachments"
              rowSelection="single" pagination="true" paginationPageSize=10>
            </ag-grid-angular>

          </div>


          <div class="page-title" *ngIf="hasId && hasQuoteDet">
            <div class="title_left">
              <h3 style="padding:15px 0 5px 0">Spare Quotation Details</h3>
            </div>
          </div>
          <div class="clearfix"></div>
          <hr />
          <div class="row my-4" *ngIf="hasId && hasQuoteDet">
            <div class="col-md-4">
              <input type="text" formControlName="spareQuoteNo" class="form-control" placeholder="Spare Quote No.">
            </div>

            <div class="col-md-4">
              <button type="button" class="btn btn-primary" (click)="getZohoData()"> Get Quote</button>
            </div>
            <div class="col-md-4">
              <a href="https://www.zoho.com/in/books/" target="_blank" class="btn btn-primary"
                (click)="form.get('spareQuoteNo').enable();">Raise Zoho Request</a>
            </div>
          </div>

          <table *ngIf="hasId && SpareQuotationDetails.length>0" class="table" style="border:1px solid black">
            <thead style="background: #589b44; color: #FFF;">
              <tr>
                <td>Customer Name</td>
                <td>Sales Order Number</td>
                <td>Total</td>
                <td>Status</td>
              </tr>
            </thead>
            <tbody>

              <tr *ngFor="let i of SpareQuotationDetails">
                <td>{{i.customer_name}}</td>
                <td>{{i.salesorder_number}}</td>
                <td>{{i.total}}</td>
                <td>{{i.status }}</td>
              </tr>
            </tbody>
          </table>

          <div class="row">
            <div class="col-md-6 col-sm-6" style="padding:10px;">
              <button *ngIf="(hasUpdateAccess) || (hasAddAccess && !hasId)" class="btn btn-primary" type="submit"
                class="btn btn-primary">
                <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
                Submit
              </button>
              <a routerLink="/offerrequestlist" class="btn btn-secondary" style="margin-left: 10px;">Back</a>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</layout>